<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project basedir="." default="create_jar" name="Create Jar for EasyFastJson.jar" >
  <echo message="basedir=${basedir}"/>
  <target name="create_jar">
    <delete dir="${basedir}/doc-api" quiet="true"/>
    <javadoc access="public" author="true"
      classpath="lib/jackson-core-2.6.5.jar;lib/jackson-databind-2.6.5.jar;lib/jackson-annotations-2.6.5.jar"
      destdir="doc-api" Windowtitle="Esay Fast Json" doctitle="Esay Fast Json" nodeprecated="false" nodeprecatedlist="false" noindex="false"
      nonavbar="false" notree="false" source="1.6" 
      splitindex="true" use="true" version="true">
      <fileset dir="src">
        <include name="org/wjw/efjson/*" />
      </fileset>
    </javadoc>

  	<delete dir="${basedir}/tmp" quiet="true"/>
    <delete file="EasyFastJson.jar" />
    <!-- 生成不需要依赖的EasyFastJson.jar  -->
  	<taskdef name="jarjar" classname="com.tonicsystems.jarjar.JarJarTask"  classpath="lib/jarjar-1.4.jar"/>
  	<jarjar jarfile="${basedir}/EasyFastJson.jar">
  		<fileset dir="${basedir}/bin">
  		  <include name="**/**" />
  		</fileset>
    	<zipfileset src="lib/jackson-core-2.6.5.jar"/>
    	<zipfileset src="lib/jackson-databind-2.6.5.jar"/>
    	<zipfileset src="lib/jackson-annotations-2.6.5.jar"/>

  		<rule pattern="com.fasterxml.jackson.**" result="internal.com.fasterxml.jackson.@1"/>
    </jarjar>
    
  	<unzip src="${basedir}/EasyFastJson.jar" dest="${basedir}/tmp">
  	</unzip>
  	<delete file="${basedir}/EasyFastJson.jar"/>
    <jar destfile="${basedir}/EasyFastJson-2.6.5.jar">
      <fileset dir="${basedir}/tmp">
        <include name="org/**" />
        <include name="internal/**" />
        <include name="META-INF/services/**" />
      </fileset>
  	  <manifest>
  		  <attribute name="Built-By" value="wjw465150@gmail.com" />
  		  <attribute name="Build-Name" value="EasyFastJson" />
  		  <attribute name="Build-Version" value="2.6.5" />
  	  </manifest>
    </jar>
  	<delete dir="${basedir}/tmp" quiet="true"/>
    

  </target>
</project>
